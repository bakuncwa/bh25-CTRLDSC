{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'ligtas_ani/css/predict.css' %}" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{%static 'ligtas_ani/img/logo.png'%}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/minty/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>LigtasAni</title>
</head>
<body style="background-color: #C7CAB9">
    <nav class="navbar navbar-expand-sm bg-light px-2">
        <div class="container-fluid shadow-none p-3 bg-light rounded">
            <a class="navbar-brand" style="color: black" href="">
                <img src="{%static 'ligtas_ani/img/plant_logo.png'%}" style="width:5rem;" class="rounded-pill">
                <b>LigtasAni</b>
            </a>
            <a class="navbar-brand" href="{% url 'ligtas_ani:add_location' %}">Soil Acidity</a>
            <a class="navbar-brand" href="{% url 'ligtas_ani:index' %}">Homepage</a>
        </div>
    </nav>

    <section class="page-section">
        <div class="container mt-4 p-3">
        <h2 class="mb-4 text-center" style="color: #386641">Ibahagi ang iyong lokasyon!</h2>

        <div style="left: 22vw" class="card shadow-md rounded p-4 col-6">
            <form method="POST">
                {% csrf_token %}

                <div class="mb-2">
                    <label for="farm_name">Name:</label>
                    <input type="text" id="farm_name" name="farm_name" class="form-control" required>
                </div>
                <div class="mb-2">
                    <label for="city">Municipality:</label>
                            <select id="city" name="city" class="form-control" required>
                                <option value="">Select Municipality</option>
                                <option value="City1">Pantabangan</option>
                                <option value="City2">Talugtug</option>
                            </select>
                </div>
                <hr>
                <div class="mb-2">
                    <label for="location">Location:</label>
                            <select id="location" name="location" class="form-control" required>
                                <option value="">Select Location</option>
                                <option value="Loc1">Desmundo Farm</option>
                                <option value="Loc2">Montana de Sol Farm</option>
                                <option value="Loc3">Prince's Farm</option>
                                <option value="Loc4">Vita's Farm</option>
                                <option value="Loc5">Luntiang Farm</option>
                            </select>
                </div>
{#                <div class="mb-2">#}
{#                    <label for="pHIndicator_val">pH Indicator:</label>#}
{#                    <input id="pHIndicator_val" name="pHIndicator_val" required>#}
{#                </div>#}
                <hr>
                <details>
                <summary style="cursor: pointer; font-weight: bold;" class="text-center p-2">View chemical factors</summary>
                    <div style="margin-top: 10px;">
                        <div class="mb-2">
                            Rainfall (mm): <input id="rainfall_val" name="rainfall_val" class="form-control" readonly>
                            <input id="rainfall_val" name="rainfall_val" type="range" class="form-range form-control" disabled>
{#                           Rainfall (mm): <input id="rainfall_val" name="rainfall_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Hydrogen (g dm<sup>-3</sup>): <input id="H_val" name="H_val" class="form-control" readonly>
                            <input id="H_val" name="H_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Hydrogen (g dm<sup>-3</sup>): <input id="H_val" name="H_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Zinc (g dm<sup>-3</sup>): <input id="Zn_val" name="Zn_val" class="form-control" readonly>
                            <input id="Zn_val" name="Zn_val" type="range" min="10e-14" max="10e-1"  class="form-range form-control" disabled>
{#                            Zinc (g dm<sup>-3</sup>): <input id="Zn_val" name="Zn_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Manganese (g dm<sup>-3</sup>): <input id="Mn_val" name="Mn_val" class="form-control" readonly>
                            <input id="Mn_val" name="Mn_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Manganese (g dm<sup>-3</sup>): <input id="Mn_val" name="Mn_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Iron (g dm<sup>-3</sup>): <input id="Fe_val" name="Fe_val" class="form-control" readonly>
                            <input id="Fe_val" name="Fe_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Iron (g dm<sup>-3</sup>): <input id="Fe_val" name="Fe_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Copper (g dm<sup>-3</sup>): <input id="Cu_val" name="Cu_val" class="form-control" readonly>
                            <input id="Cu_val" name="Cu_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Copper (g dm<sup>-3</sup>): <input id="Cu_val" name="Cu_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Phosphorus (g dm<sup>-3</sup>): <input id="P_val" name="P_val" class="form-control" readonly>
                            <input id="P_val" name="P_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Phosphorus (g dm<sup>-3</sup>): <input id="P_val" name="P_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Sodium (g dm<sup>-3</sup>): <input id="Na_val" name="Na_val" class="form-control" readonly>
                            <input id="Na_val" name="Na_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Sodium (g dm<sup>-3</sup>): <input id="Na_val" name="Na_val" class="form-control" readonly>#}
                        </div>
                        <div class="mb-2">
                            Nitrogen (g dm<sup>-3</sup>): <input id="N_val" name="N_val" class="form-control" readonly>
                            <input id="N_val" name="N_val" type="range" min="10e-14" max="10e-1" class="form-range form-control" disabled>
{#                            Nitrogen (g dm<sup>-3</sup>): <input id="N_val" name="N_val" class="form-control" readonly>#}
                        </div>
                    </div>
                </details>


                <hr>
                <div class="col-12" style="padding-left: 12%">
                    <div class="text-center p-2 hstack">
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Record Prediction
                            </button>
                            <a href="{% url 'ligtas_ani:index' %}" class="btn btn-outline-primary">
                            <i class="fas fa-list"></i> View Homepage
                            </a>
                        </div>
                    </div>
                    </div>
            </form>
        </div>
    </div>
    </section>>

    {% if prediction is not None %}

        <div class="container mt-4 p-3">
        <h3 class="mb-4 text-center fade-in-title" style="color: #386641">Prediction Result:</h3>
        <div style="left: 22vw" class="card shadow-md rounded p-4 col-6">
                <div class="result">
{#                    {{ prediction }}#}
                    {% if prediction == 0 %}
                        <h4 style="color: green;" class="text-center"><strong>Low soil acidity</strong></h4>
                        <img class="grainy fade-in" src="{%static 'ligtas_ani/img/low_acid.png'%}">
{#                        <div class="text-center justify-content-center">#}
                        <br>
                            <p>
                                Ang mga pagkakataon ng malakas na pag-ulan ay mababa, at ang iyong mga pananim ay
                                malusog at umuunlad! Tandaan na bantayan ang konsentrasyon ng sustansya ng iyong lupain
                                - laging maging handa!
                            </p>
                                <ol><li>Maglagay ng compost o dumi ng hayop upang mapataas
                                ang antas ng nitrogen, sulfide, phosphorus</li></ol>
{#                        </div>#}
                    {% elif prediction == 1 %}
                        <h4 style="color: blue;" class="text-center"><strong>High soil acidity</strong></h4>
                        <img class="grainy fade-in" src="{%static 'ligtas_ani/img/high_acid.png'%}">
                        <br>
                        <p>
                        Ang mga antas ng tubig ay tumataas dahil sa pagtaas ng dami ng pag-ulan, kaya
                        siguraduhing maiwasan ang acid concentration build-up sa pamamagitan ng paggawa ng mga sumusunod!
                        </p>
                        <ol>
                            <li>Magbigay ng dolomitic o calcitic lime upang mapataas ang antas ng calcium ng iyong mga pananim</li>
                            <li> Magbigay ng rice husk upang mapataas ang antas ng calcium ng iyong mga pananim</li>
                        </ol>
{#                            {% for feature in top_features %}#}
{#                                <p><strong>{{ feature.Feature }}</strong>: {{ feature.Importance }}</p>#}
{#                            {% endfor %}#}
{#                            <h5>Top Features for Soil Acidity</h5>#}
{#                            <div id="feature-importance-plot">#}
{#                                <img src="/{{ plot_url }}" alt="Feature Importance Plot">#}
{#                            </div>#}
                </div>
            </div>
         </div>
{% endif %}

    {% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const cityToLocations = {
            'City1': [
                { value: 'Loc1', text: "Desmundo Farm" },
                { value: 'Loc2', text: "Montana de Sol Farm" },
                { value: 'Loc3', text: "Prince's Farm" }
            ],
            'City2': [
                { value: 'Loc4', text: "Vita's Farm" },
                { value: 'Loc5', text: "Luntiang Farm" }
            ]
        };

        const locationToParams = {
            'Loc1': [38.45, 0.119, 0.154, 0.137, 0.149, 0.124, 0.210, 0.008, 0.150],
            'Loc2': [96.07, 0.110, 0.183, 0.118, 0.039, 0.191, 0.120, 0.006, 0.018],
            'Loc3': [74.19, 0.005, 0.057, 0.066, 0.200, 0.028, 0.166, 0.170, 0.055],
            'Loc4': [60.86, 0.078, 0.143, 0.001, 0.141, 0.029, 0.100, 0.073, 0.178],
            'Loc5': [16.60, 0.087, 0.131, 0.114, 0.036, 0.128, 0.144, 0.183, 0.121],
        };

        const cityDropdown = document.getElementById('city');
        const locationDropdown = document.getElementById('location');

        const paramInputs = {
            'rainfall_val': document.getElementById('rainfall_val'),
            'H_val': document.getElementById('H_val'),
            'Zn_val': document.getElementById('Zn_val'),
            'Mn_val': document.getElementById('Mn_val'),
            'Fe_val': document.getElementById('Fe_val'),
            'Cu_val': document.getElementById('Cu_val'),
            'P_val': document.getElementById('P_val'),
            'Na_val': document.getElementById('Na_val'),
            'N_val': document.getElementById('N_val'),
            'pHIndicator_val': document.getElementById('pHIndicator_val')
        };

        function updateLocations() {
            locationDropdown.innerHTML = '';
            const selectedCity = cityDropdown.value;
            const locations = cityToLocations[selectedCity] || [];

            if (locations.length === 0) {
                locationDropdown.innerHTML = '<option value="">Select Location</option>';
                resetSoilParameters();
                return;
            }

            locations.forEach((loc, index) => {
                const option = document.createElement('option');
                option.value = loc.value;
                option.textContent = loc.text;
                locationDropdown.appendChild(option);
            });

            locationDropdown.value = locations[0].value;
            updateSoilParameters();
        }

        function updateSoilParameters() {
            const selectedLocation = locationDropdown.value;
            const params = locationToParams[selectedLocation];

            if (params) {
                Object.keys(paramInputs).forEach((key, index) => {
                    paramInputs[key].value = params[index];
                });
            } else {
                resetSoilParameters();
            }
        }

        function resetSoilParameters() {
            Object.keys(paramInputs).forEach(key => {
                paramInputs[key].value = '';
            });
        }

        cityDropdown.addEventListener('change', updateLocations);
        locationDropdown.addEventListener('change', updateSoilParameters);

        updateLocations();
    });
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>